## 三维CAD建模课程作业

#### 任务

1）定义半边数据结构；

2）基于半边数据结构，实现五个基本欧拉操作；

3）基于欧拉操作，实现扫掠操作（必须允许二维区域带多个内环），并将基于扫掠操作构建的实体模型进行真实感图形显示。

#### 结果展示

以自己名字首字母为例

实体模型：

![image-20221110132933344](/../../img/image-20221110132933344.png)

线框模型：

![image-20221110133039164](/../../img/image-20221110133039164.png)

多孔：

![image-20221110133214221](/../../img/image-20221110133214221.png)



#### 实现的主要功能

(1)通过课上讲解的知识点以及相关伪代码案例实现了基于B-rep的数据结构
(2)实现了6个最常用的欧拉操作,以及扫琼操作

> mvfs():定义一个体、一个面、一个外环、一个点
> mev():构造一个新点，同时构造一条连接新点与一给定点的边
> mef():构造一条新边，同时构造一个新面
> kemr():消去环中的一条边，构造一个内环
> kfmrh():删除一个面，并将其定义为一个内环，进而在体中构造一个柄，或将两个物体合并一个物体
> semv():在给定边上构造一个新点，同时将边分裂为两条边
> sweep():基于B-rep及相关的欧拉操作进行扫成操作

(3)利用Qt的OpenGL库进行图形绘制，将基于扫琼操作的实体模型进行可视化（可以显示线框模型和实体模型）
(4)支持↑、↓、←、→转向观察等交互操作

#### 使用指南

**请将exe文件放置在与输入文件Input.txt文件同级别目录下**

##### 输入

- 以文件txt进行输入，具体格式参考input.txt文件

  ```txt
  polygon_num       //所有环的数量
  5
  point_num         //每个环包含点数量及点坐标
  4 8 6 7 4
  
  -20.0 20.0 0.0    //第一个环的点坐标
  -20.0 -20.0 0.0
  50.0 -20.0 0.0
  50.0 20.0 0.0
  
  -10.0 10.0 0.0    //第二个环的点坐标
  -10.0 -10.0 0.0
  10.0 -10.0 0.0
  10.0 -5.0 0.0
  -5.0 -5.0 0.0
  -5.0 5.0 0.0
  5.0 5.0 0.0
  10.0 10.0 0.0
  
  
  15.0 10.0 0.0     //第三个环的点坐标
  15.0 -10.0 0.0
  25.0 -10.0 0.0
  25.0 -5.0 0.0
  20.0 -5.0 0.0
  20.0 10.0 0.0
  
  30.0 10.0 0.0     //第四个环的点坐标
  30.0 -10.0 0.0
  40.0 -10.0 0.0
  42.0 -12.0 0.0
  44.0 -10.0 0.0
  40.0 -6.0 0.0
  40.0 10.0 0.0
  
  32.5 5.0 0.0       //第五个环的点坐标
  32.5 -5.0 0.0
  35.0 -5.0 0.0
  35.0 5.0 0.0
  
  0.0 0.0 50.0       //扫成向量
  ```

- 格式为：第1行底面的环数量polygon_num（包括外环和所有内环）；

- 然后输入每个环的数据，每个环的数据格式为：第1行为1个整数m，表示该环有m个顶点，之后的m行按逆时针（俯视角）顺序每行输入1个点的坐标（浮点数），x、y、z坐标以空格分隔；

- 最后，输入扫掠操作的向量。



##### 输出

**采用多种方式的输出**

1.图形输出

按↑，↓控制模型绕y轴旋转，按←，→建控制模型绕x轴旋转 

鼠标右键唤醒菜单栏

2.控制台txt输出

控制台输出为扫成构造的实体的所有表面及其中的环、组成环的坐标。



#### 开发环境和配置

操作系统: Windows10 x64
集成开发环境: Qt  OpenGL
编译器：vs2017

#### 算法详细

详细参考代码

```c
//mvfs操作，构造一个实体，得到一个面一个点，一个环
Solid* mvfs(Point *p)
```

```c
//构造一个新点，同时构造一条连接新点与给定点的边
HalfEdge* mev(Point *oldPoint, Point *newPoint, Loop *lp);
//判断v1 点是否在solid中
//建立半边结构，添加到lp中
//判断是否是lp的首条边
//不是第一条边，则先建立he2相关连接
```

```C
//在两给定点间构造一个新边，同时构造一个新面，以及一个外环
Loop* mef(Point *p1, Point *p2, Loop *lp);
//外环根据右手法则指向体外
//将V2为起点的环作为外环(原lp)，he1在外环中；V1为起点的环作为内环（newLp），he2在内环中
//返回的为内环
```

```C
//消去环中的一条边，构造一个内环(innerLp),原环为外环(lp)
Loop* kemr(Point *p1, Point *p2, Loop *lp);
//删除边，分四种情况  边在中间、末尾、顶端、单边
```

```C
//删除一个面，将其定义为另一个面的内环，在体中构造一个柄/或将两物体合并
void kfmrh(Loop *OuterLp ,Loop *InnerLp);
//先判断环是否正确
//删除面，分四种情况
```

```C
//Sweeping Operation
void sweeping (Face *face ,Point *sweepPoint);
//平移扫成操作,轨迹线为一条直线，轨迹线为原点和给定的扫描点组成的直线
//遍历每个lp
```

#### 项目结构

![image-20221110132551918](/../../img/image-20221110132551918.png)